# Contributing to Gob

## Intro

If you'd like to contribute, and don't know where to get started you can start
by looking at the open issues on GitHub and seeing if there's anything there
that interests you, or by reading the section CSS: The Missing Parts at the bottom
of this document listing what pieces of CSS are known to be not implemented or 
implemented incorrectly and try your hand at one of them. It turns out that 
writing an entirely new rendering engine from scratch in pure Go is a lot of
work, so there's a lot there to work on.

If you'd like to propose a change that involves significant changes but isn't listed
here, it's a good idea to create a GitHub issue to discuss what you want to do and 
your intended design first (or at least give a heads up at driusan@gmail.com).

## My Plan

My general plan to get from here to a "real", useable web browser is to implement
enough of the CSS Level 1 and 2.2 specs so that most pages render useably (which generally 
means the visual formatting model, and CSS Level 1), even if the implementation is a hack,
 then instead of spending a lot of time going through the spec with a fine tooth comb and
doing it properly, jumping straight to the appropriate CSS Level 3 modules that supercede 
2.2 and implementing those "properly"

Somewhere along the line, support for form and input elements need to be added so you can do more
than click on links (like use a search engine), and at least basic javascript support
will need to be added (probably using ottojs, but I'm willing to use any pure Go javascript
engine..) so that you can use webapps.

## The Gob Architecture

See the file DESIGN.md for an overview of the code layout if it helps you get
started.

## CSS: The Missing Parts

These are the parts of the CSS spec that are known to be not or improperly implemented. If
anything else is rendering incorrectly, please create an issue.

For each item, I've tried to put a brief description of what's involved in getting it working.
They're listed in order of CSS Level, not difficulty.

### CSS Level 1

#### Selectors:
- missing pseudo-selector support (:link, :visited, :active, :first-line, and :first-letter)

The :link/:visited pseudo-selectors should just require the renderer to check in the Gob cache 
generated by the net package and apply the correct style.. :active will require elements having 
some kind of state that the renderer can track, and :first-line/:first-letter is more complicated,
as, there's currently no obvious way to create pseudo-elements in the render tree.

#### Fonts:
- incomplete font-family property
- missing font-variant property
- missing font short-hand property

Only the DejaVu fonts are used, which means cursive and fantasy font-families fallback on sans-serif.
The font-weight of the DejaVu Sans-Serif isn't necessarily properly implemented, because I haven't
looked up how the "ExtraLight" weight corresponds to CSS font weights to implement it in accordance
with the spec.


#### Background:
- background-image-attachment and background-image-position not supported. 

Attachment: fixed would require re-rendering the page for every scroll event. It's probably not
realistic until the layout/draw is more separated (see note in z-index property.). image-position
should just involve doing the math in RenderableDomElement.getCSSBox.

#### Text Properties:
- missing word-spacing
- missing letter-spacing
- missing vertical-align
- missing text-align
- text is not centered when line-height is set

Word spacing should just involve adding the appropriate space in renderLineBox.
Letter-spacing would require changing the rendering to be letter based, instead of
word based. Text-align should just involve moving the rectangle that render draws
the output of renderLineBox into, I don't know what's involved in vertical-align,
and the text being centered in the lineheight just involves working out the math
from the font metrics.

#### Box properties:
- missing "auto" support for margin
- missing thin/medium/thick border keywords
- only "solid" border-style works
- missing border-right/left/top/bottom shorthand

The auto claim isn't ctually true, it is somewhat implemented, but
not according to the spec and they hasn't been tested.

The thin/medium/thick keywords should be trivial to add in RenderableDomElement.getCSSBox.

Border styles would involve working out the appropriate image mask in getCSSBox. The shorthands just need to be parsed and added in the css package.

#### Display model
- missing clear property
- missing display: list-item 
- missing list-item related properties (list-style-type/list-style-image/list-style-position and list-style shorthand properties)

Clear should just involve setting dot appropriately near the start of a layout/render pass.
List-item should be trivial to add by adding a couple if statements as it's fairly similar to
block. (it just needs to draw an image and adjust dot.)

#### Other:
- missing @import
- missing comments

The css tokenizer is mostly a hack based on the strings package. Import is easy enought to hack in,
but comments probably need a real tokenizer and should just go straight to implementing the CSS3Syntax
spec.

- missing in/cm/mm/pt/pc units

These are mostly missing because shiny doesn't currently provide any way to get the screen resolution,
which is required to calculate them.


### Missing from CSS 2.2:

#### General:
- everything should be reviewed to make sure it's not subtly incompatible with what's implemented.
- shorthand properties should reset to initial value before setting.
- missing @media and media types (should support all, screen, continuous, visual, interactive)
- missing counter-increment/counter-reset (section 4.3.5, 12.4)

@media probably requires a proper tokenizer too. counter-increment/reset should be easy to
add by storing a map[countername]uint somewhere.

#### Selectors:
- Missing E > F selector
- missing E + F selector
- missing :first-child selector
- missing :lang selector
- missing E[foo]
- missing E[foo="string"]
- missing E[foo~="string"]
- missing E[lang|="en"]

"E > F" and "E + F" require a proper tokenizer, since the whitespace is optional.

The rest can be added fairly easily by adding to the existing selector tests in the css package
and then implementing the in the (css/CSSSelector.)Matches(html.Node) function

#### Box model:
- missing direction and unicode-bidi properties
- missing inline-block and table (and table related) display types
- missing position attribute
- missing top/right/bottom/left attributes (for positioned elements.)
- missing z-index property

I don't know what's involve in the direction properties. inline-block can probably be implemented
by a couple if statements around how dot is advanced in the normal block render path.

position and related will just involve translating the drawing rectangle without touching dot in
the render method, similarly to how floats do.

z-index should just require keeping track of the max/min child z-index and
ranging through them, only drawing the appropriate ones in the DrawPass,
but there's no point implementing it until position is implemented, since
things can't overlap otherwise.

#### Visual Effects:
- missing clip property
- missing visibility property

Overflow will require coming up with a way to draw a scrollbar and scroll. The rest should just require passing
an appropriate mask to Draw in the render method.

#### Generated Content:
- missing :before and :after pseudo-elements
- missing content property
- missing quotes property

Same issues as CSS1 pseudo-elements.

#### Lists:
- list-style-type needs more options
- white-space should have pre-line wrap option added

These are mostly just cases where the spec exploded in size and the extra options
need to be supported.

#### Tables:
- missing display: types for tables
- missing caption-side attribute
- missing table-layout property
- missing border-collapse property
- missing border-spacing property
- missing empty-cells property

table and related display/property types will probably require writing a (or many) new case(s) to the render
switch statement that need to be written. It's probably a significant amount of work, but largely
independent of the rest of the codebase. 

#### UI:
- missing cursor property
- missing system colours? (Not In CSS3?)
- missing outline/outline-width/outline-style/outline-color properties

Shiny doesn't support any way to set the cursor. System colours are deprecated in CSS (and
shiny doesn't have any way to retrieve them..)
Outline I haven't looked into, but I suspect it could share a lot of code with borders.
